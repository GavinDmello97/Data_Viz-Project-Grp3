<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content= "width=device-width, user-scalable=no">

    <link
      href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia|Trirongs|Roboto+Slab&effect=neon|outline|emboss|shadow-multiple|fire">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=PT+Serif&family=Roboto+Slab&display=swap" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet" />
    <script src="js/mobiscroll.javascript.min.js"></script>
<link href="css/mobiscroll.javascript.min.css" rel="stylesheet" type="text/css">
    <script src="./libs/d3.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <title>CO2 Emission</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="https://unpkg.com/topojson-client@2"></script>
    <script src="js/mobiscroll.javascript.min.js"></script>
    <link href="css/mobiscroll.javascript.min.css" rel="stylesheet" type="text/css">
    <style>
      h2.font {
        font-family: 'PT Serif', serif;
      }

      .slider-container {
        background-color: red;
        height: 10%
      }
      

    </style>
     <script type="text/javascript" src="js/index.js">

     </script>
  </head>
  <body>
    <div id="container">
      <div id="headerContainer">
        <h2  id="header-h1-text" class="font ">Contributers of CO2 emission </h1>
      </div>
      <div class="containers">
        <div class="worldContainer containerPadder">
          <svg id="canvas"  style=" width: 100%; height: 90%" viewBox="0 0 1000 600"></svg>
           
            <div class=slider-container>
                  <input
                  mbsc-slider
                  id="slider"
                  type="range"
                  value="0"
                  min= "0"
                  max="7"
                  mobiscroll-slider="sliderSettings"
                  data-step-labels="[0,1,2,3,4,5,6,7]"
                  data-highlight="false"
                />                
               
            </div>
        

        </div>
        <div class="worldContainer containerPadder">
          <!-- <svg id="canvas"></svg> -->
        </div>
      </div>
    </div>
    <!-- <div id="tooltip"></div> -->
    <script>

   
      
      let svg = d3.select("svg");
      // load the data sources:
      // Source 1: NY times COVID-19 Data (live)
      let covid19 =
        "https://raw.githubusercontent.com/nytimes/covid-19-data/master/live/us-counties.csv";
      // source 2: US Census Counties geojson
      let topoJson = "data/countries-110m.json";
      let projection = d3.geoEquirectangular().scale(150).translate([500, 150]);
      Promise.all([d3.json(topoJson), d3.csv(covid19)], d3.autoType()).then(
        (data) => main(data)
      );

      main = (data) => {
        //converting topojson to geosjon
        let geoJsonData = topojson.feature(
          data[0],
          data[0].objects.countries
        ).features;
        let geoGenerator = d3.geoPath().projection(projection);
        let covid_data = d3.group(data[1], (d) => d.fips);
        let cases_extent = d3.extent(data[1], (d) => {
          return +d.cases;
        });
        cases_extent[0] = 1;

        // let colorScale = d3
        //   .scaleLog()
        //   .domain(cases_extent)
        //   .range(["white", "steelblue"])
        //   .interpolate(d3.interpolateCubehelix.gamma(1));

        let mapCanvas = svg.append("g");
        mapCanvas
          .attr("transform", "scale(1, 1.9)")
          .selectAll("path")
          .data(geoJsonData)
          .enter()
          .append("path")
          .attr("class", "path_geo")
          .attr("d", geoGenerator)
          .attr("fill", "blue")
          .on("mousemove", (mouseData, d) => {
            d3.select("#tooltip")
              .style("opacity", 0.8)
              .style("left", (mouseData.clientX + 10).toString() + "px")
              .style("top", (mouseData.clientY + 10).toString() + "px")
              .html(
                "<div class='tooltipData'>County: " +
                  covid_data.get(d.properties.GEOID)[0].county +
                  "</div>" +
                  "<div class='tooltipData'>State: " +
                  covid_data.get(d.properties.GEOID)[0].state +
                  "</div>" +
                  "<div class='tooltipData' style='color:blue'>Cases: " +
                  covid_data.get(d.properties.GEOID)[0].cases.toString() +
                  "</div>" +
                  "<div class='tooltipData' style='color:red'>Deaths: " +
                  covid_data.get(d.properties.GEOID)[0].deaths.toString() +
                  "</div>" +
                  "<div class='tooltipData'></div>"
              );
          })
          .transition()
          .delay((d, i) => {
            return i * 2;
          })
          .duration(300)
          .style("fill", (d) => {
            try {
              return colorScale(
                parseInt(covid_data.get(d.properties.GEOID)[0].cases)
              );
            } catch (error) {
              return "white";
            }
          });

        svg.call(
          d3
            .zoom()
            .extent([
              [0, 0],
              [1000, 1000],
            ])
            .scaleExtent([1, 4])
            .on("zoom", zoomed)
        );

          mobiscroll.settings = {
        theme: 'ios',
        themeVariant: 'light',
        lang: 'en'
    };

    var dayNames =[
  '1975', '1985',
  '1995', '2005',
  '2010', '2015',
  '2016', '2017'
]
        
        slider = document.getElementById('slider'),
    
    function setText(d) {
        document.querySelector('.md-date').innerHTML = monthNames[d.getMonth()] + " " + d.getDate();
    }

    slider.step = 1
    
    slider
        .addEventListener('change', function (ev) {
            setText(nextWeek[Math.round(this.value)]);
        });
        

    mobiscroll.form('#demo', {
        lang: 'en',                       // Specify language like: lang: 'pl' or omit setting to use default
        theme: 'ios',                     // Specify theme like: theme: 'ios' or omit setting to use default
        themeVariant: 'light'             // More info about themeVariant: https://docs.mobiscroll.com/4-10-9/javascript/forms#opt-themeVariant
    });
    
    mobiscroll.slider('#slider', {
        theme: 'ios',                     // Specify theme like: theme: 'ios' or omit setting to use default
        themeVariant: 'light',            // More info about themeVariant: https://docs.mobiscroll.com/4-10-9/javascript/forms#opt-themeVariant
        lang: 'en',                       // Specify language like: lang: 'pl' or omit setting to use default
        onInit: function (event, inst) {  // More info about onInit: https://docs.mobiscroll.com/4-10-9/javascript/forms#event-onInit
            var labels = slider.parentNode.querySelectorAll('.mbsc-progress-step-label');
            for (var i = 0; i < dayNames.length; ++i) {
                labels[i].innerHTML = dayNames[i];
            }
            console.log(slider.parentNode.querySelectorAll('data-step-labels'))

        }, 
        
    });
        
        function zoomed({ transform }) {
          mapCanvas.attr("transform", transform);
        }
      };
    </script>
  </body>
</html>
